<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>‚Çπ@‚ìñ$ ùï±‚úó1 ‚Äî Final</title>
<link rel="icon" type="image/png" href="icon.png">
<link rel="apple-touch-icon" href="icon.png">
<link rel="manifest" href="manifest.json">

<!-- Firebase scripts -->
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-auth-compat.js"></script>

<style>
:root{--accent:#007bff;--bg:#f4f6fb;--card:#fff;--muted:#666}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:system-ui,Segoe UI,Roboto,Arial;background:var(--bg);-webkit-font-smoothing:antialiased}
.wrap{max-width:720px;margin:48px auto;padding:12px}
.card{background:var(--card);border-radius:12px;padding:16px;box-shadow:0 8px 24px rgba(10,10,20,0.06)}
h1{text-align:center;font-size:20px;margin-bottom:12px}
label{display:block;margin-top:10px;font-weight:600;color:#222;font-size:14px}
select,input,button{width:100%;padding:10px;border-radius:8px;border:1px solid #d6dbe6;font-size:15px;margin-top:6px}
button{background:var(--accent);color:#fff;border:0;cursor:pointer}
button.secondary{background:#eee;color:#111}
.small{font-size:13px;color:#666;margin-top:8px}
.row{display:flex;gap:8px;margin-top:10px}
.row button{flex:1}
.pair-list{max-height:260px;overflow:auto;border:1px solid #eee;padding:8px;border-radius:8px;background:#fafafa;margin-top:8px}
.pair-item{display:flex;align-items:center;justify-content:space-between;padding:8px;border-bottom:1px solid #eee}
.pair-item:last-child{border-bottom:0}
.small-btn{padding:6px 8px;border-radius:6px;border:0;background:#eee;color:#111;cursor:pointer}
.modal{position:fixed;inset:0;display:none;align-items:flex-start;justify-content:center;background:rgba(0,0,0,0.55);z-index:9999;padding:12px;overflow-y:auto;}
.panel{background:#fff;padding:14px;border-radius:10px;max-height:90vh;overflow-y:auto;max-width:720px;width:100%}
#lotResult{margin-top:12px;text-align:center;font-weight:700;color:#06204a;font-size:18px;background:#e8f0ff;display:inline-block;padding:6px 12px;border-radius:8px;box-shadow:0 2px 6px rgba(10,20,60,0.06);}
@media(max-width:480px){.row{flex-direction:column}.row button{width:100%}}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>‚Çπ@‚ìñ$ ùï±‚úó</h1>

    <!-- Authentication Section -->
    <div id="authSection">
      <input id="email" type="email" placeholder="Email">
      <input id="password" type="password" placeholder="Password">
      <input id="confirmPassword" type="password" placeholder="Confirm Password" style="display:none">
      <div class="row" style="margin-top:10px">
        <button id="loginBtn">Login</button>
        <button id="signupBtn">Sign Up</button>
        <button id="createBtn" style="display:none">Create</button>
      </div>
      <button class="secondary" id="forgotBtn" style="margin-top:6px">Forgot Password?</button>
      <div id="authMsg" class="small"></div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminSection" style="display:none;margin-top:20px">
      <h3>Admin Dashboard</h3>
      <div id="userList" class="pair-list"></div>
    </div>

    <!-- Calculator Section -->
    <div id="calcSection" style="display:none">
      <label for="pairSelect">Pair</label>
      <select id="pairSelect"></select>
      <label for="lotType">Lot type / mode</label>
      <select id="lotType">
        <option value="standardPoint">Standard Point Value</option>
        <option value="miniPoint">Mini Point Value</option>
        <option value="microPoint">Micro Point Value</option>
        <option value="standardPip">Standard Pip Value</option>
        <option value="miniPip">Mini Pip Value</option>
        <option value="microPip">Micro Pip Value</option>
      </select>
      <label for="risk">Risk ($)</label>
      <input id="risk" type="number" placeholder="e.g. 30">
      <label for="sl">Stop-loss (points / pips)</label>
      <input id="sl" type="number" placeholder="e.g. 15">
      <div class="row">
        <button onclick="calculateLot()">Calculate Lot Size</button>
        <button class="secondary" onclick="clearCalc()">Clear</button>
      </div>
      <div id="lotResult" aria-live="polite" style="display:none"></div>
      <div class="row" style="margin-top:12px">
        <button class="secondary" onclick="openModal()">Add / Edit / Sync</button>
        <button class="secondary" id="logoutBtn" onclick="logout()">Logout</button>
        <button class="secondary" onclick="reloadCloud()">Reload Cloud</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Editor -->
<div id="modal" class="modal" aria-hidden="true">
  <div class="panel" role="dialog" aria-modal="true">
    <h3>Add / Edit / Sync Pairs</h3>
    <div id="stepUnlock">
      <div class="small">Enter App Password</div>
      <input id="modalAppPw" type="password" placeholder="App password">
      <div class="row" style="margin-top:8px">
        <button onclick="unlockModal()">Continue</button>
        <button class="secondary" onclick="closeModal()">Close</button>
      </div>
      <div id="unlockErr" class="small" style="color:#b00020"></div>
    </div>
    <div id="editor" style="display:none;margin-top:12px">
      <label>Pair code (e.g. EURUSD)</label>
      <input id="editName" placeholder="PAIR (uppercase)">
      <label>Point value (1 standard lot)</label>
      <input id="editPoint" type="number" placeholder="point">
      <label>Pip value (1 standard lot)</label>
      <input id="editPip" type="number" placeholder="pip">
      <label>Commission ($ per 1 lot)</label>
      <input id="editCommission" type="number" placeholder="commission">
      <div class="row" style="margin-top:8px">
        <button onclick="saveLocalPair()">Save Local</button>
        <button class="secondary" onclick="openSyncArea()">Sync Cloud</button>
        <button class="secondary" onclick="populateEditorLists()">Delete / Edit</button>
      </div>
      <div style="margin-top:8px">
        <button class="secondary" onclick="closeModal()">Close</button>
      </div>

      <!-- Sync area -->
      <div id="syncArea" style="display:none;margin-top:12px">
        <div class="small">Enter Cloud Password</div>
        <input id="cloudPw" type="password" placeholder="Cloud password">
        <div class="row" style="margin-top:8px">
          <button onclick="unlockCloudForSync()">Unlock Cloud</button>
          <button class="secondary" onclick="closeSyncArea()">Cancel</button>
        </div>
        <div id="syncListWrap" style="display:none;margin-top:10px">
          <div class="small">Select LOCAL pairs to push to cloud</div>
          <div id="syncList" class="pair-list"></div>
          <div class="row" style="margin-top:8px">
            <button onclick="pushSelectedToCloud()">Push Selected to Cloud</button>
            <button class="secondary" onclick="closeSyncArea()">Done</button>
          </div>
        </div>
      </div>

      <!-- Delete/Edit area -->
      <div id="deArea" style="display:none;margin-top:12px">
        <div class="small">Pairs (C = cloud, L = local)</div>
        <div id="deList" class="pair-list"></div>
      </div>
    </div>
  </div>
</div>
<script>
// ------------------------- Firebase Setup -------------------------
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_DOMAIN",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_BUCKET",
  messagingSenderId: "YOUR_SENDER",
  appId: "YOUR_APPID"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// ------------------------- Auth Elements -------------------------
const emailInput = document.getElementById('email');
const passwordInput = document.getElementById('password');
const confirmInput = document.getElementById('confirmPassword');
const loginBtn = document.getElementById('loginBtn');
const signupBtn = document.getElementById('signupBtn');
const createBtn = document.getElementById('createBtn');
const forgotBtn = document.getElementById('forgotBtn');
const authMsg = document.getElementById('authMsg');

const authSection = document.getElementById('authSection');
const adminSection = document.getElementById('adminSection');
const calcSection = document.getElementById('calcSection');
const logoutBtn = document.getElementById('logoutBtn');

let currentUser = null;

// ------------------------- Pair & Modal Elements -------------------------
const pairSelect = document.getElementById('pairSelect');
const lotType = document.getElementById('lotType');
const riskInput = document.getElementById('risk');
const slInput = document.getElementById('sl');
const lotResult = document.getElementById('lotResult');

const modal = document.getElementById('modal');
const stepUnlock = document.getElementById('stepUnlock');
const editor = document.getElementById('editor');
const unlockErr = document.getElementById('unlockErr');
const modalAppPw = document.getElementById('modalAppPw');
const editName = document.getElementById('editName');
const editPoint = document.getElementById('editPoint');
const editPip = document.getElementById('editPip');
const editCommission = document.getElementById('editCommission');
const syncArea = document.getElementById('syncArea');
const cloudPw = document.getElementById('cloudPw');
const syncListWrap = document.getElementById('syncListWrap');
const syncList = document.getElementById('syncList');
const deArea = document.getElementById('deArea');
const deList = document.getElementById('deList');

let LOCAL_PAIRS = [];
let CLOUD_PAIRS = [];
let MODAL_UNLOCKED = false;
const APP_PASSWORD = "admin123"; // replace with your app password
const CLOUD_PASSWORD = "cloud123"; // replace with your cloud password

// ------------------------- Auth Functions -------------------------
loginBtn.addEventListener('click', () => {
  const email = emailInput.value.trim();
  const pw = passwordInput.value.trim();
  auth.signInWithEmailAndPassword(email, pw)
    .then(res => { currentUser = res.user; postLogin(); })
    .catch(err => { authMsg.textContent = err.message; });
});

signupBtn.addEventListener('click', () => {
  confirmInput.style.display = "block";
  createBtn.style.display = "inline-block";
  signupBtn.style.display = "none";
});

createBtn.addEventListener('click', () => {
  const email = emailInput.value.trim();
  const pw = passwordInput.value.trim();
  const confirm = confirmInput.value.trim();
  if (pw !== confirm) { authMsg.textContent="Passwords do not match"; return; }
  auth.createUserWithEmailAndPassword(email,pw)
    .then(res => { authMsg.textContent="Signup successful. Wait for admin approval."; confirmInput.style.display="none"; createBtn.style.display="none"; signupBtn.style.display="inline-block"; })
    .catch(err => { authMsg.textContent = err.message; });
});

forgotBtn.addEventListener('click', () => {
  const email = emailInput.value.trim();
  if(!email) return authMsg.textContent="Enter email first";
  auth.sendPasswordResetEmail(email)
    .then(()=> authMsg.textContent="Reset email sent.")
    .catch(err=>authMsg.textContent=err.message);
});

logoutBtn.addEventListener('click', logout);

function logout() {
  auth.signOut().then(() => location.reload());
}

function postLogin() {
  authSection.style.display="none";
  calcSection.style.display="block";
  loadLocalPairs();
  loadCloudPairs();
}

// ------------------------- Calculator -------------------------
function loadLocalPairs() {
  const stored = localStorage.getItem('pairs');
  LOCAL_PAIRS = stored ? JSON.parse(stored) : [];
  populatePairSelect();
}

function populatePairSelect() {
  pairSelect.innerHTML="";
  LOCAL_PAIRS.concat(CLOUD_PAIRS).forEach(p => {
    const opt = document.createElement('option');
    opt.value = p.name;
    opt.textContent = `${p.name} (${p.point}/${p.pip})`;
    pairSelect.appendChild(opt);
  });
}

function calculateLot() {
  const pair = LOCAL_PAIRS.concat(CLOUD_PAIRS).find(p=>p.name===pairSelect.value);
  if(!pair) { lotResult.style.display="none"; return; }
  const risk = parseFloat(riskInput.value);
  const sl = parseFloat(slInput.value);
  if(isNaN(risk)||isNaN(sl)){ lotResult.style.display="none"; return; }
  let lotSize;
  switch(lotType.value){
    case "standardPoint": lotSize = risk / (sl*pair.point); break;
    case "miniPoint": lotSize = risk / (sl*pair.point*0.1); break;
    case "microPoint": lotSize = risk / (sl*pair.point*0.01); break;
    case "standardPip": lotSize = risk / (sl*pair.pip); break;
    case "miniPip": lotSize = risk / (sl*pair.pip*0.1); break;
    case "microPip": lotSize = risk / (sl*pair.pip*0.01); break;
  }
  lotResult.style.display="inline-block";
  lotResult.textContent = "Lot Size: "+lotSize.toFixed(2);
}

function clearCalc() {
  riskInput.value=""; slInput.value=""; lotResult.style.display="none";
}

// ------------------------- Modal Functions -------------------------
function openModal() {
  modal.style.display="flex";
  stepUnlock.style.display="block";
  editor.style.display="none";
  MODAL_UNLOCKED=false;
  modalAppPw.value="";
  unlockErr.textContent="";
  deArea.style.display="none";
  syncArea.style.display="none";
}

function closeModal() { modal.style.display="none"; }

function unlockModal() {
  if(modalAppPw.value!==APP_PASSWORD){ unlockErr.textContent="Incorrect password"; return; }
  MODAL_UNLOCKED=true;
  stepUnlock.style.display="none";
  editor.style.display="block";
  populateEditorLists();
}

// ------------------------- Local Pair Management -------------------------
function saveLocalPair() {
  const name = editName.value.trim().toUpperCase();
  const point = parseFloat(editPoint.value);
  const pip = parseFloat(editPip.value);
  const com = parseFloat(editCommission.value);
  if(!name||isNaN(point)||isNaN(pip)||isNaN(com)){ alert("Fill all fields correctly"); return; }
  const existIndex = LOCAL_PAIRS.findIndex(p=>p.name===name);
  if(existIndex>-1) LOCAL_PAIRS[existIndex] = {name,point,pip,commission:com};
  else LOCAL_PAIRS.push({name,point,pip,commission:com});
  localStorage.setItem('pairs',JSON.stringify(LOCAL_PAIRS));
  populatePairSelect();
  populateEditorLists();
}

// ------------------------- Delete / Edit -------------------------
function populateEditorLists() {
  // Delete/Edit List
  deList.innerHTML="";
  LOCAL_PAIRS.concat(CLOUD_PAIRS).forEach((p,i)=>{
    const div=document.createElement('div');
    div.className="pair-item";
    div.textContent=`${p.name} ${LOCAL_PAIRS.includes(p)?"(L)":"(C)"}`;
    const btnDel=document.createElement('button'); btnDel.textContent="Delete"; btnDel.className="small-btn";
    btnDel.onclick=()=>{ deletePair(p); };
    const btnUp=document.createElement('button'); btnUp.textContent="‚Üë"; btnUp.className="small-btn";
    btnUp.onclick=()=>{ movePair(p,-1); };
    const btnDown=document.createElement('button'); btnDown.textContent="‚Üì"; btnDown.className="small-btn";
    btnDown.onclick=()=>{ movePair(p,1); };
    div.appendChild(btnDel); div.appendChild(btnUp); div.appendChild(btnDown);
    deList.appendChild(div);
  });
  deArea.style.display="block";
}

function deletePair(p){
  if(LOCAL_PAIRS.includes(p)) LOCAL_PAIRS = LOCAL_PAIRS.filter(x=>x!==p);
  if(CLOUD_PAIRS.includes(p)) CLOUD_PAIRS = CLOUD_PAIRS.filter(x=>x!==p);
  localStorage.setItem('pairs',JSON.stringify(LOCAL_PAIRS));
  populatePairSelect();
  populateEditorLists();
}

function movePair(p,dir){
  let arr = LOCAL_PAIRS.includes(p)?LOCAL_PAIRS:CLOUD_PAIRS;
  const idx = arr.indexOf(p);
  const newIdx = idx+dir;
  if(newIdx<0 || newIdx>=arr.length) return;
  [arr[idx],arr[newIdx]]=[arr[newIdx],arr[idx]];
  localStorage.setItem('pairs',JSON.stringify(LOCAL_PAIRS));
  populatePairSelect();
  populateEditorLists();
}

// ------------------------- Cloud Sync -------------------------
function openSyncArea(){ syncArea.style.display="block"; }
function closeSyncArea(){ syncArea.style.display="none"; syncListWrap.style.display="none"; cloudPw.value=""; }
function unlockCloudForSync(){
  if(cloudPw.value!==CLOUD_PASSWORD){ alert("Wrong cloud password"); return; }
  syncListWrap.style.display="block";
  syncList.innerHTML="";
  LOCAL_PAIRS.forEach(p=>{
    const div = document.createElement('div');
    div.className="pair-item";
    const checkbox=document.createElement('input'); checkbox.type="checkbox"; checkbox.value=p.name;
    div.appendChild(checkbox);
    div.appendChild(document.createTextNode(` ${p.name}`));
    syncList.appendChild(div);
  });
}
function pushSelectedToCloud(){
  const selected = Array.from(syncList.querySelectorAll('input[type=checkbox]:checked')).map(cb=>cb.value);
  selected.forEach(name=>{
    const pair = LOCAL_PAIRS.find(p=>p.name===name);
    if(pair && !CLOUD_PAIRS.some(p=>p.name===name)) CLOUD_PAIRS.push({...pair});
  });
  closeSyncArea();
  populatePairSelect();
  populateEditorLists();
}
function reloadCloud(){ populatePairSelect(); populateEditorLists(); }

// ------------------------- Init -------------------------
window.onload=()=>{ auth.onAuthStateChanged(user=>{ if(user){ currentUser=user; postLogin(); } }); }

</script>
<script>
// ------------------------- Modal & UI Helpers -------------------------
document.getElementById('openModalBtn').addEventListener('click', openModal);
document.getElementById('closeModalBtn').addEventListener('click', closeModal);
document.getElementById('unlockBtn').addEventListener('click', unlockModal);
document.getElementById('savePairBtn').addEventListener('click', saveLocalPair);

document.getElementById('openSyncBtn').addEventListener('click', openSyncArea);
document.getElementById('closeSyncBtn').addEventListener('click', closeSyncArea);
document.getElementById('unlockCloudBtn').addEventListener('click', unlockCloudForSync);
document.getElementById('pushCloudBtn').addEventListener('click', pushSelectedToCloud);

// ------------------------- UI Input Bindings -------------------------
pairSelect.addEventListener('change', calculateLot);
riskInput.addEventListener('input', calculateLot);
slInput.addEventListener('input', calculateLot);
lotType.addEventListener('change', calculateLot);

// ------------------------- Clear All -------------------------
function clearAll() {
  LOCAL_PAIRS = [];
  CLOUD_PAIRS = [];
  localStorage.removeItem('pairs');
  populatePairSelect();
  populateEditorLists();
}

// ------------------------- Debug Helpers (Optional) -------------------------
function showAllPairs() {
  console.log("Local Pairs:", LOCAL_PAIRS);
  console.log("Cloud Pairs:", CLOUD_PAIRS);
}

// ------------------------- Ensure Everything Loads -------------------------
window.addEventListener('load', () => {
  if(currentUser) postLogin();
});

// ------------------------- Optional Admin Functions -------------------------
function approveUser(email) {
  // Example placeholder if you want admin approvals
  db.collection('users').doc(email).update({approved:true})
    .then(()=>alert(email+" approved"))
    .catch(e=>alert(e.message));
}

function removeUser(email) {
  db.collection('users').doc(email).delete()
    .then(()=>alert(email+" removed"))
    .catch(e=>alert(e.message));
}

// ------------------------- Finished -------------------------
console.log("All scripts loaded successfully. Calculator, pairs, modal, cloud sync ready.");
</script>
