<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>‚Çπ@‚ìñ$ ùï±‚úó ‚Äî Final</title>
<link rel="icon" type="image/png" href="icon.png">
<link rel="apple-touch-icon" href="icon.png">
<link rel="manifest" href="manifest.json">

<!-- Firebase scripts -->
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-auth-compat.js"></script>

<style>
:root{--accent:#007bff;--bg:#f4f6fb;--card:#fff;--muted:#666}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:system-ui,Segoe UI,Roboto,Arial;background:var(--bg);-webkit-font-smoothing:antialiased}
.wrap{max-width:720px;margin:48px auto;padding:12px}
.card{background:var(--card);border-radius:12px;padding:16px;box-shadow:0 8px 24px rgba(10,10,20,0.06)}
h1{text-align:center;font-size:20px;margin-bottom:12px}
label{display:block;margin-top:10px;font-weight:600;color:#222;font-size:14px}
select,input,button{width:100%;padding:10px;border-radius:8px;border:1px solid #d6dbe6;font-size:15px;margin-top:6px}
button{background:var(--accent);color:#fff;border:0;cursor:pointer}
button.secondary{background:#eee;color:#111}
.small{font-size:13px;color:#666;margin-top:8px}
.row{display:flex;gap:8px;margin-top:10px}
.row button{flex:1}
.pair-list{max-height:260px;overflow:auto;border:1px solid #eee;padding:8px;border-radius:8px;background:#fafafa;margin-top:8px}
.pair-item{display:flex;align-items:center;justify-content:space-between;padding:8px;border-bottom:1px solid #eee}
.pair-item:last-child{border-bottom:0}
.small-btn{padding:3px 6px;border-radius:6px;border:0;background:#eee;color:#111;cursor:pointer;font-size:12px;margin-left:4px}
.pair-item div{display:flex;gap:2px}
.modal{position:fixed;inset:0;display:none;align-items:flex-start;justify-content:center;background:rgba(0,0,0,0.55);z-index:9999;padding:12px;overflow-y:auto}
.panel{background:#fff;padding:14px;border-radius:10px;max-height:90vh;overflow-y:auto;max-width:720px;width:100%}
#lotResult{margin-top:12px;text-align:center;font-weight:700;color:#06204a;font-size:18px;background:#e8f0ff;display:inline-block;padding:6px 12px;border-radius:8px;box-shadow:0 2px 6px rgba(10,20,60,0.06)}
@media(max-width:480px){.row{flex-direction:column}.row button{width:100%}}
</style>
</head>

<body>
<div class="wrap">
  <div class="card">
    <h1>‚Çπ@‚ìñ$ ùï±‚úó</h1>

    <!-- Authentication Section -->
    <div id="authSection">
      <input id="email" type="email" placeholder="Email">
      <input id="password" type="password" placeholder="Password">
      <input id="confirmPassword" type="password" placeholder="Confirm Password" style="display:none">
      <div class="row" style="margin-top:10px">
        <button id="loginBtn">Login</button>
        <button id="signupBtn">Sign Up</button>
        <button id="createBtn" style="display:none">Create</button>
      </div>
      <button class="secondary" id="forgotBtn" style="margin-top:6px">Forgot Password?</button>
      <div id="authMsg" class="small"></div>
    </div>

    <!-- Calculator Section -->
    <div id="calcSection" style="display:none">
      <label for="pairSelect">Pair</label>
      <select id="pairSelect"></select>

      <label for="lotType">Lot type / mode</label>
      <select id="lotType">
        <option value="standardPoint">Standard Point Value</option>
        <option value="miniPoint">Mini Point Value</option>
        <option value="microPoint">Micro Point Value</option>
        <option value="standardPip">Standard Pip Value</option>
        <option value="miniPip">Mini Pip Value</option>
        <option value="microPip">Micro Pip Value</option>
      </select>

      <label for="risk">Risk ($)</label>
      <input id="risk" type="number" placeholder="e.g. 30">

      <label for="sl">Stop-loss (points / pips)</label>
      <input id="sl" type="number" placeholder="e.g. 15">

      <div class="row">
        <button onclick="calculateLot()">Calculate Lot Size</button>
        <button class="secondary" onclick="clearCalc()">Clear</button>
      </div>

      <div id="lotResult" style="display:none"></div>

      <div class="row" style="margin-top:12px">
        <button class="secondary" onclick="openModal()">Add / Edit / Sync</button>
        <button class="secondary" onclick="logout()">Logout</button>
        <button class="secondary" onclick="reloadCloud()">Reload Cloud</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Editor (APP PASSWORD REMOVED) -->
<div id="modal" class="modal">
  <div class="panel">
    <h3>Add / Edit / Sync Pairs</h3>

    <label>Pair code (e.g. EURUSD)</label>
    <input id="editName">

    <label>Point value (1 standard lot)</label>
    <input id="editPoint" type="number">

    <label>Pip value (1 standard lot)</label>
    <input id="editPip" type="number">

    <label>Commission ($ per 1 lot)</label>
    <input id="editCommission" type="number">

    <div class="row" style="margin-top:8px">
      <button onclick="saveLocalPair()">Save Local</button>
      <button class="secondary" onclick="openSyncArea()">Sync Cloud</button>
      <button class="secondary" onclick="openDeleteEdit()">Delete / Edit</button>
    </div>

    <div style="margin-top:8px">
      <button class="secondary" onclick="closeModal()">Close</button>
    </div>

    <div id="syncArea" style="display:none;margin-top:12px">
      <div class="small">Enter Cloud Password</div>
      <input id="cloudPw" type="password">
      <div class="row" style="margin-top:8px">
        <button onclick="unlockCloudForSync()">Unlock Cloud</button>
        <button class="secondary" onclick="closeSyncArea()">Cancel</button>
      </div>
      <div id="syncListWrap" style="display:none;margin-top:10px">
        <div class="small">Select LOCAL pairs to push to cloud</div>
        <div id="syncList" class="pair-list"></div>
        <div class="row" style="margin-top:8px">
          <button onclick="pushSelectedToCloud()">Push Selected to Cloud</button>
          <button class="secondary" onclick="closeSyncArea()">Done</button>
        </div>
      </div>
    </div>

    <div id="deArea" style="display:none;margin-top:12px">
      <div class="small">Pairs (C = cloud, L = local)</div>
      <div id="deList" class="pair-list"></div>
      <div class="row" style="margin-top:8px">
        <button class="secondary" onclick="closeDeleteEdit()">Close</button>
      </div>
    </div>
  </div>
</div>

<script>
// ===================== Firebase =====================
const authApp = firebase.initializeApp({
  apiKey: "AIzaSyBf-D1KYMJ_b3_1Dog7AkJ8b0MST0fD_9g",
  authDomain: "auth-9bef7.firebaseapp.com",
  projectId: "auth-9bef7",
  storageBucket: "auth-9bef7.firebasestorage.app",
  messagingSenderId: "27179558968",
  appId: "1:27179558968:web:cbc4c3b162ea2114c11ecd"
}, "authApp");
const auth = authApp.auth();

const cloudApp = firebase.initializeApp({
  apiKey: "AIzaSyAnt7Ctex3Eom36UTt1PzkOw1vCSXNBEzk",
  authDomain: "lotcalci.firebaseapp.com",
  projectId: "lotcalci",
  storageBucket: "lotcalci.firebasestorage.app",
  messagingSenderId: "662389905318",
  appId: "1:662389905318:web:3b9963ab853374ee606167"
}, "cloudApp");
const db = cloudApp.firestore();

// ===================== Globals =====================
const LOCAL_KEY="fx_pairs_v_final";
const FIRE_COLLECTION="cloudPairs";
const CLOUD_PASSWORD="123456";
let pairs={};
let unsubscribeSnapshot=null;

// ===================== Local / Cloud =====================
function loadLocalPairs(){
  const raw=localStorage.getItem(LOCAL_KEY);
  pairs=raw?JSON.parse(raw):{};
}
function saveLocalPairs(){
  localStorage.setItem(LOCAL_KEY,JSON.stringify(pairs));
}
function populateDropdown(){
  const sel=document.getElementById('pairSelect');
  sel.innerHTML='';
  Object.keys(pairs)
    .sort((a,b)=>(pairs[a].order??0)-(pairs[b].order??0))
    .forEach(name=>{
      const opt=document.createElement('option');
      opt.value=name;
      opt.text=pairs[name].type==='cloud'?`${name} (C)`:`${name} (L)`;
      sel.appendChild(opt);
    });
}
function startCloudListener(){
  if(unsubscribeSnapshot) unsubscribeSnapshot();
  unsubscribeSnapshot=db.collection(FIRE_COLLECTION).onSnapshot(snap=>{
    snap.forEach(doc=>{
      const d=doc.data();
      const local=pairs[doc.id]||{};
      pairs[doc.id]={...local,...d,type:'cloud'};
    });
    saveLocalPairs();
    populateDropdown();
  });
}

// ===================== Calculator =====================
function calculateLot(){
  const name=pairSelect.value;
  const risk=+document.getElementById('risk').value;
  const sl=+document.getElementById('sl').value;
  if(!pairs[name]||!risk||!sl) return;
  const p=pairs[name];
  let v=0;
  switch(lotType.value){
    case "standardPoint": v=p.point; break;
    case "miniPoint": v=p.point/10; break;
    case "microPoint": v=p.point/100; break;
    case "standardPip": v=p.pip; break;
    case "miniPip": v=p.pip/10; break;
    case "microPip": v=p.pip/100; break;
  }
  const lot=risk/(sl*v+(p.commission||0));
  lotResult.innerHTML=`LotSize = ${lot.toFixed(2)}`;
  lotResult.style.display='inline-block';
}
function clearCalc(){
  risk.value='';sl.value='';lotResult.style.display='none';
}

// ===================== Modal / Pair =====================
function openModal(){modal.style.display='flex'}
function closeModal(){modal.style.display='none';closeSyncArea();closeDeleteEdit();}
function saveLocalPair(){
  const name=editName.value.toUpperCase().trim();
  if(!name) return;
  pairs[name]={point:+editPoint.value,pip:+editPip.value,commission:+editCommission.value,type:'local'};
  saveLocalPairs();populateDropdown();
}
function openSyncArea(){document.getElementById('syncArea').style.display='block'}
function closeSyncArea(){document.getElementById('syncArea').style.display='none'}
function unlockCloudForSync(){
  if(cloudPw.value===CLOUD_PASSWORD){
    document.getElementById('syncListWrap').style.display='block';
    const wrap=document.getElementById('syncList');
    wrap.innerHTML='';
    Object.keys(pairs).forEach(n=>{
      if(pairs[n].type==='local'){
        wrap.innerHTML+=`<div class="pair-item"><span>${n}</span><input type="checkbox" data-name="${n}"></div>`;
      }
    });
  }
}
function pushSelectedToCloud(){
  document.querySelectorAll('#syncList input:checked').forEach(cb=>{
    const n=cb.dataset.name;
    db.collection(FIRE_COLLECTION).doc(n).set(pairs[n]);
    pairs[n].type='cloud';
  });
  saveLocalPairs();populateDropdown();
}
function openDeleteEdit(){}
function closeDeleteEdit(){}

// ===================== Auth =====================
function login(){
  auth.signInWithEmailAndPassword(email.value,password.value)
    .then(()=>{
      authSection.style.display='none';
      calcSection.style.display='block';
      loadLocalPairs();
      populateDropdown();
      startCloudListener();
    })
    .catch(e=>authMsg.innerText=e.message);
}
function signup(){
  confirmPassword.style.display='block';
  createBtn.style.display='inline-block';
  signupBtn.style.display='none';
}
function create(){
  if(password.value!==confirmPassword.value){
    authMsg.innerText="Passwords do not match";return;
  }
  auth.createUserWithEmailAndPassword(email.value,password.value)
    .then(()=>authMsg.innerText="User created. Login now.")
    .catch(e=>authMsg.innerText=e.message);
}
function logout(){
  auth.signOut();
  calcSection.style.display='none';
  authSection.style.display='block';
  authMsg.innerText='';
}

// ===================== Forgot Password =====================
function forgotPassword(){
  const e=email.value.trim();
  if(!e){authMsg.innerText="Enter your email first";return;}
  auth.sendPasswordResetEmail(e)
    .then(()=>authMsg.innerText="Password reset link sent to your email.")
    .catch(err=>authMsg.innerText=err.message);
}

function reloadCloud(){startCloudListener();}

// ===================== Events =====================
loginBtn.onclick=login;
signupBtn.onclick=signup;
createBtn.onclick=create;
forgotBtn.onclick=forgotPassword;
</script>
</body>
</html>