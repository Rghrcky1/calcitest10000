<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>‚Çπ@‚ìñ$ ùï±‚úó ‚Äî Final</title>

<link rel="icon" type="image/png" href="icon.png">
<link rel="apple-touch-icon" href="icon.png">
<link rel="manifest" href="manifest.json">

<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-firestore-compat.js"></script>

<style>
:root{--accent:#007bff;--bg:#f4f6fb;--card:#fff}
*{box-sizing:border-box}
html,body{margin:0;font-family:system-ui;background:var(--bg)}
.wrap{max-width:720px;margin:48px auto;padding:12px}
.card{background:#fff;border-radius:12px;padding:16px;box-shadow:0 8px 24px rgba(0,0,0,.06)}
button{padding:10px;border-radius:8px;border:0;background:var(--accent);color:#fff}
button.secondary{background:#eee;color:#000}
#lotResult{margin-top:12px;font-weight:700;color:#06204a;background:#e8f0ff;padding:6px 12px;border-radius:8px;display:none}
.modal{position:fixed;inset:0;display:none;justify-content:center;background:rgba(0,0,0,.55)}
.panel{background:#fff;padding:14px;border-radius:10px;width:100%;max-width:720px}
</style>
</head>

<body>
<div class="wrap">
<div class="card">
<h1>‚Çπ@‚ìñ$ ùï±‚úó</h1>

<select id="pairSelect"></select>

<input id="risk" type="number" placeholder="Risk">
<input id="sl" type="number" placeholder="Stop Loss">

<button onclick="calculateLot()">Calculate</button>
<button class="secondary" onclick="logout()" id="logoutBtn" style="display:none">Logout</button>

<div id="lotResult"></div>
</div>
</div>

<script>
/* ================= CONFIG ================= */
const APP_PASSWORD = "6565";
const CLOUD_PASSWORD = "123456";
const LOCAL_KEY = "fx_pairs_v_final";

/* ====== AUTO LOCK SYSTEM ====== */
const UNLOCK_TTL = 24 * 60 * 60 * 1000;
const PASS_VERSION_KEY = "fx_pass_version";

function now(){ return Date.now(); }

function forceLock(){
  localStorage.removeItem("fx_unlocked");
  localStorage.removeItem("fx_last_unlock");
  localStorage.removeItem("fx_local_pass_ver");
}

function isSessionValid(){
  if(localStorage.getItem("fx_unlocked")!=="1") return false;
  const t = Number(localStorage.getItem("fx_last_unlock")||0);
  if(now()-t > UNLOCK_TTL) return false;
  const localVer = localStorage.getItem("fx_local_pass_ver");
  const globalVer = localStorage.getItem(PASS_VERSION_KEY);
  if(localVer && globalVer && localVer!==globalVer) return false;
  return true;
}

/* ===== Firebase ===== */
firebase.initializeApp({
  apiKey: "AIzaSyAnt7Ctex3Eom36UTt1PzkOw1vCSXNBEzk",
  authDomain: "lotcalci.firebaseapp.com",
  projectId: "lotcalci"
});
firebase.firestore();

/* ===== Dummy calc ===== */
function calculateLot(){
  document.getElementById("lotResult").style.display="block";
  document.getElementById("lotResult").innerText="LotSize = 0.88";
}

/* ===== Unlock ===== */
function unlockApp(){
  const pw = prompt("Enter App Password");
  if(pw!==APP_PASSWORD){ alert("Wrong password"); return; }

  localStorage.setItem("fx_unlocked","1");
  localStorage.setItem("fx_last_unlock", now());

  if(!localStorage.getItem(PASS_VERSION_KEY))
    localStorage.setItem(PASS_VERSION_KEY,"1");

  localStorage.setItem("fx_local_pass_ver",localStorage.getItem(PASS_VERSION_KEY));
  document.getElementById("logoutBtn").style.display="inline-block";
}

/* ===== Logout ===== */
function logout(){
  forceLock();
  document.getElementById("logoutBtn").style.display="none";
  alert("Logged out");
}

/* ===== Init ===== */
document.addEventListener("DOMContentLoaded",()=>{
  if(!isSessionValid()){
    forceLock();
    unlockApp();
  } else {
    document.getElementById("logoutBtn").style.display="inline-block";
  }
});
</script>
</body>
</html>
