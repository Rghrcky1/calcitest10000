<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>‚Çπ@‚ìñ$ ùï±‚úó ‚Äî Final</title>
<!-- App Icons -->
<link rel="icon" type="image/png" href="icon.png">
<link rel="apple-touch-icon" href="icon.png">

<!-- PWA Manifest -->
<link rel="manifest" href="manifest.json">

<!-- Firebase scripts -->
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-auth-compat.js"></script>

<style>
  :root{--accent:#007bff;--bg:#f4f6fb;--card:#fff;--muted:#666}
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:system-ui,Segoe UI,Roboto,Arial;background:var(--bg);-webkit-font-smoothing:antialiased}
  .wrap{max-width:720px;margin:48px auto;padding:12px}
  .card{background:var(--card);border-radius:12px;padding:16px;box-shadow:0 8px 24px rgba(10,10,20,0.06)}
  h1{text-align:center;font-size:20px;margin-bottom:12px}
  label{display:block;margin-top:10px;font-weight:600;color:#222;font-size:14px}
  select,input,button{width:100%;padding:10px;border-radius:8px;border:1px solid #d6dbe6;font-size:15px;margin-top:6px}
  button{background:var(--accent);color:#fff;border:0;cursor:pointer}
  button.secondary{background:#eee;color:#111}
  .small{font-size:13px;color:#666;margin-top:8px}
  .row{display:flex;gap:8px;margin-top:10px}
  .row button{flex:1}
  .pair-list{max-height:260px;overflow:auto;border:1px solid #eee;padding:8px;border-radius:8px;background:#fafafa;margin-top:8px}
  .pair-item{display:flex;align-items:center;justify-content:space-between;padding:8px;border-bottom:1px solid #eee}
  .pair-item:last-child{border-bottom:0}
  .small-btn{padding:6px 8px;border-radius:6px;border:0;background:#eee;color:#111;cursor:pointer}
  .modal{position:fixed;inset:0;display:none;align-items:flex-start;justify-content:center;background:rgba(0,0,0,0.55);z-index:9999;padding:12px;overflow-y:auto;}
  .panel{background:#fff;padding:14px;border-radius:10px;max-height:90vh;overflow-y:auto;max-width:720px;width:100%}
  #lotResult {margin-top:12px;text-align:center;font-weight:700;color:#06204a;font-size:18px;background:#e8f0ff;display:inline-block;padding:6px 12px;border-radius:8px;box-shadow:0 2px 6px rgba(10,20,60,0.06);}
  @media (max-width:480px){.row{flex-direction:column}.row button{width:100%}}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>‚Çπ@‚ìñ$ ùï±‚úó</h1>

    <!-- Login/Signup -->
    <div id="authSection">
      <input id="email" type="email" placeholder="Email">
      <input id="password" type="password" placeholder="Password">
      <input id="confirmPassword" type="password" placeholder="Confirm Password" style="display:none">
      <div class="row" style="margin-top:10px">
        <button id="loginBtn">Login</button>
        <button id="signupBtn">Sign Up</button>
      </div>
      <button class="secondary" id="forgotBtn" style="margin-top:6px">Forgot Password?</button>
      <div id="authMsg" class="small"></div>
    </div>

    <!-- Calculator -->
    <div id="calcSection" style="display:none">
      <label for="pairSelect">Pair</label>
      <select id="pairSelect"></select>
      <label for="lotType">Lot type / mode</label>
      <select id="lotType">
        <option value="standardPoint">Standard Point Value</option>
        <option value="miniPoint">Mini Point Value</option>
        <option value="microPoint">Micro Point Value</option>
        <option value="standardPip">Standard Pip Value</option>
        <option value="miniPip">Mini Pip Value</option>
        <option value="microPip">Micro Pip Value</option>
      </select>
      <label for="risk">Risk ($)</label>
      <input id="risk" type="number" placeholder="e.g. 30">
      <label for="sl">Stop-loss (points / pips)</label>
      <input id="sl" type="number" placeholder="e.g. 15">
      <div class="row">
        <button onclick="calculateLot()">Calculate Lot Size</button>
        <button class="secondary" onclick="clearCalc()">Clear</button>
      </div>
      <div id="lotResult" aria-live="polite" style="display:none"></div>
      <div class="row" style="margin-top:12px">
        <button class="secondary" onclick="openModal()">Add / Edit / Sync</button>
        <button class="secondary" id="logoutBtn" onclick="logout()">Logout</button>
        <button class="secondary" onclick="reloadCloud()">Reload Cloud</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal for editing/syncing (same as before) -->
<div id="modal" class="modal" aria-hidden="true">
  <div class="panel" role="dialog" aria-modal="true">
    <h3>Add / Edit / Sync Pairs</h3>
    <div id="stepUnlock">
      <div class="small">Enter App Password</div>
      <input id="modalAppPw" type="password" placeholder="App password">
      <div class="row" style="margin-top:8px">
        <button onclick="unlockModal()">Continue</button>
        <button class="secondary" onclick="closeModal()">Close</button>
      </div>
      <div id="unlockErr" class="small" style="color:#b00020"></div>
    </div>
    <div id="editor" style="display:none;margin-top:12px">
      <!-- same editor inputs as before -->
    </div>
  </div>
</div>

<script>
/* ===== Firebase projects ===== */
// Auth project
const authApp = firebase.initializeApp({
  apiKey: "AIzaSyBf-D1KYMJ_b3_1Dog7AkJ8b0MST0fD_9g",
  authDomain: "auth-9bef7.firebaseapp.com",
  projectId: "auth-9bef7",
  storageBucket: "auth-9bef7.firebasestorage.app",
  messagingSenderId: "27179558968",
  appId: "1:27179558968:web:cbc4c3b162ea2114c11ecd"
}, "authApp");
const auth = authApp.auth();
const authDb = authApp.firestore();

// Cloud project (calculator data)
const cloudApp = firebase.initializeApp({
  apiKey: "AIzaSyAnt7Ctex3Eom36UTt1PzkOw1vCSXNBEzk",
  authDomain: "lotcalci.firebaseapp.com",
  projectId: "lotcalci",
  storageBucket: "lotcalci.firebasestorage.app",
  messagingSenderId: "662389905318",
  appId: "1:662389905318:web:3b9963ab853374ee606167"
}, "cloudApp");
const db = cloudApp.firestore();

/* ===== Global vars ===== */
const APP_PASSWORD="6565";
const CLOUD_PASSWORD="123456";
const LOCAL_KEY="fx_pairs_v_final";
const FIRE_COLLECTION="cloudPairs";
let pairs = {};

/* ===================== Authentication ===================== */
document.getElementById('signupBtn').onclick = async ()=>{
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value;
  const confirm = document.getElementById('confirmPassword').value;
  if(password !== confirm){ showMsg("Passwords do not match"); return; }
  try{
    const userCred = await auth.createUserWithEmailAndPassword(email,password);
    // Add user to Firestore with status pending
    await authDb.collection("users").doc(userCred.user.uid).set({email,status:"pending"});
    showMsg("Signup successful! Waiting for admin approval.");
  }catch(e){ showMsg(e.message); }
};

document.getElementById('loginBtn').onclick = async ()=>{
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value;
  try{
    const userCred = await auth.signInWithEmailAndPassword(email,password);
    const doc = await authDb.collection("users").doc(userCred.user.uid).get();
    const status = doc.exists ? doc.data().status : "pending";
    if(status !== "approved"){ auth.signOut(); showMsg("Not approved by admin yet"); return; }
    // success ‚Üí show calculator
    document.getElementById('authSection').style.display='none';
    document.getElementById('calcSection').style.display='block';
    loadLocalPairs();
    populateDropdown();
  }catch(e){ showMsg(e.message); }
};

document.getElementById('forgotBtn').onclick = async ()=>{
  const email = document.getElementById('email').value.trim();
  if(!email){ showMsg("Enter email first"); return; }
  try{ await auth.sendPasswordResetEmail(email); showMsg("Reset link sent"); }
  catch(e){ showMsg(e.message); }
};

function showMsg(msg){ document.getElementById('authMsg').innerText = msg; }

/* ================= Calculator & Cloud code ================= */
// Paste all your previous calculator & cloud code here (unchanged) including:
// - loadLocalPairs, saveLocalPairs
// - populateDropdown
// - startCloudListener
// - calculateLot, clearCalc
// - modal, unlockModal, saveLocalPair
// - pushSelectedToCloud, deleteFromList, reloadCloud, etc.

// At logout
function logout(){
  auth.signOut();
  document.getElementById('calcSection').style.display='none';
  document.getElementById('authSection').style.display='block';
  showMsg("Logged out");
}

/* DOM Ready */
document.addEventListener('DOMContentLoaded',()=>{
  document.getElementById('loginBtn').style.display='inline-block';
  document.getElementById('confirmPassword').style.display='none';
  document.getElementById('signupBtn').onclick = ()=>{
    document.getElementById('confirmPassword').style.display='inline-block';
  };
});
</script>
</body>
</html>
