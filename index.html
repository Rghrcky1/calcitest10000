<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Forex Lot Calculator</title>

<style>
body{margin:0;font-family:system-ui;background:#f4f6fb}
.container{max-width:420px;margin:auto;padding:14px}
.card{background:#fff;padding:16px;border-radius:12px;box-shadow:0 8px 20px rgba(0,0,0,.08)}
label{display:block;margin-top:10px;font-weight:600}
select,input,button{width:100%;margin-top:6px;padding:10px;border-radius:8px;border:1px solid #ccc;font-size:15px}
button{background:#2563eb;color:#fff;border:none}
button.secondary{background:#e5e7eb;color:#111}
button.danger{background:#dc2626}
.top{display:flex;justify-content:space-between;margin-bottom:10px}
#logoutBtn{display:none}

#result{margin-top:14px;text-align:center}
#lotValue{
  font-size:18px;
  font-weight:800;
  color:#0a1a55;
  background:#dce8ff;
  display:inline-block;
  padding:6px 14px;
  border-radius:8px;
}

/* lock */
#lock{position:fixed;inset:0;background:#0f172a;display:flex;align-items:center;justify-content:center}
#lockBox{background:#fff;padding:20px;border-radius:12px;width:90%;max-width:340px}

/* modal */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;justify-content:center;align-items:center;overflow-y:auto}
.panel{background:#fff;width:92%;max-width:420px;border-radius:12px;padding:16px;max-height:90vh;overflow-y:auto}
.small{font-size:13px;color:#555}
</style>

<!-- Firebase COMPAT -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>

<body>

<!-- LOCK -->
<div id="lock">
  <div id="lockBox">
    <h3>Unlock App</h3>
    <input id="appPw" type="password" placeholder="App password">
    <button onclick="unlock()">Unlock</button>
    <div id="lockMsg" class="small"></div>
  </div>
</div>

<div class="container">
  <div class="top">
    <button class="secondary" onclick="openModal()">Add / Edit</button>
    <button class="secondary" id="logoutBtn" onclick="logout()">Logout</button>
  </div>

  <div class="card">
    <label>Pair</label>
    <select id="pair"></select>

    <label>Risk ($)</label>
    <input id="risk" type="number">

    <label>Stop Loss (pips)</label>
    <input id="sl" type="number">

    <button onclick="calc()">Calculate</button>
    <div id="result"></div>
  </div>
</div>

<!-- MODAL -->
<div id="modal" class="modal">
  <div class="panel">

    <div id="stepApp">
      <h3>Enter App Password</h3>
      <input id="modalAppPw" type="password">
      <button onclick="unlockModal()">Continue</button>
      <button class="secondary" onclick="closeModal()">Close</button>
    </div>

    <div id="editor" style="display:none">
      <h3>Local pairs</h3>
      <div id="localList"></div>

      <h3>Sync to Cloud</h3>
      <input id="cloudPw" type="password" placeholder="Cloud password">
      <button onclick="syncCloud()">Push Selected</button>

      <h3>Delete</h3>
      <div id="deleteList"></div>
      <button class="danger" onclick="deleteSelected()">Delete Selected</button>

      <button class="secondary" onclick="closeModal()">Close</button>
    </div>

  </div>
</div>

<script>
/* ===== CONFIG ===== */
const APP_PASSWORD="6565";
const CLOUD_PASSWORD="123456";
const STORE_KEY="fx_pairs";

/* ===== FIREBASE CONFIG (PASTE YOURS) ===== */
const firebaseConfig = {
  apiKey: "AIzaSyAnt7Ctex3Eom36UTt1PzkOw1vCSXNBEzk",
  authDomain: "lotcalci.firebaseapp.com",
  projectId: "lotcalci",
  storageBucket: "lotcalci.firebasestorage.app",
  messagingSenderId: "662389905318",
  appId: "1:662389905318:web:3b9963ab853374ee606167"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();

/* ===== DEFAULT PAIRS ===== */
const defaults={
  EURUSD:{pip:10,commission:4},
  GBPUSD:{pip:10,commission:4},
  AUDUSD:{pip:10,commission:4},
  NZDUSD:{pip:10,commission:4},
  USDJPY:{pip:6.9,commission:4},
  USDCAD:{pip:10,commission:4},
  USDCHF:{pip:9.1,commission:4},
  EURJPY:{pip:7.6,commission:4},
  AUDJPY:{pip:6.3,commission:4},
  XAUUSD:{pip:10,commission:0.0008}
};

let pairs=JSON.parse(localStorage.getItem(STORE_KEY))||{...defaults};
localStorage.setItem(STORE_KEY,JSON.stringify(pairs));

/* ===== INIT ===== */
function fill(){
  pair.innerHTML="";
  Object.keys(pairs).forEach(k=>{
    let o=document.createElement("option");
    o.value=k;o.textContent=k;
    pair.appendChild(o);
  });
}
fill();

/* ===== CALC ===== */
function calc(){
  const p=pairs[pair.value];
  const r=+risk.value,s=+sl.value;
  if(!p||!r||!s)return;
  const lot=r/(s*p.pip+p.commission);
  result.innerHTML=`Lot Size<br><span id="lotValue">${lot.toFixed(2)}</span>`;
}

/* ===== LOCK ===== */
function unlock(){
  if(appPw.value===APP_PASSWORD){
    localStorage.setItem("unlocked","1");
    lock.style.display="none";
    logoutBtn.style.display="inline-block";
  }else lockMsg.textContent="Wrong password";
}
if(localStorage.getItem("unlocked")==="1"){
  lock.style.display="none";
  logoutBtn.style.display="inline-block";
}
function logout(){
  localStorage.removeItem("unlocked");
  location.reload();
}

/* ===== MODAL ===== */
function openModal(){
  modal.style.display="flex";
  stepApp.style.display="block";
  editor.style.display="none";
}
function closeModal(){modal.style.display="none"}
function unlockModal(){
  if(modalAppPw.value===APP_PASSWORD){
    stepApp.style.display="none";
    editor.style.display="block";
    renderLists();
  }
}

/* ===== LISTS ===== */
function renderLists(){
  localList.innerHTML="";
  deleteList.innerHTML="";
  Object.keys(pairs).forEach(k=>{
    localList.innerHTML+=`<label><input type="checkbox" value="${k}"> ${k}</label>`;
    deleteList.innerHTML+=`<label><input type="checkbox" value="${k}"> ${k}</label>`;
  });
}

/* ===== CLOUD ===== */
async function syncCloud(){
  if(cloudPw.value!==CLOUD_PASSWORD) return alert("Wrong cloud password");
  const cbs=[...localList.querySelectorAll("input:checked")];
  for(const c of cbs){
    await db.collection("cloudPairs").doc(c.value).set(pairs[c.value]);
  }
  alert("Synced to cloud");
}

async function deleteSelected(){
  const cbs=[...deleteList.querySelectorAll("input:checked")];
  for(const c of cbs){
    delete pairs[c.value];
    await db.collection("cloudPairs").doc(c.value).delete().catch(()=>{});
  }
  localStorage.setItem(STORE_KEY,JSON.stringify(pairs));
  fill();
  renderLists();
}
</script>
</body>
</html>
